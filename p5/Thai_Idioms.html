<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏õ‡∏£‡∏∞‡∏•‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤ ‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ Ultimate v5.6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #4338ca 100%);
            height: 100vh; display: flex; align-items: center; justify-content: center;
            margin: 0; padding: 10px; overflow: hidden;
        }
        .glass {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 40px;
            width: 95vw; height: 95vh;
            display: flex; flex-direction: column;
            box-shadow: 0 0 40px rgba(0,0,0,0.4);
        }
        
        /* ‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏£‡πå‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏î‡πÉ‡∏™ */
        .custom-scroll::-webkit-scrollbar { width: 10px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb { 
            background: linear-gradient(to bottom, #818cf8, #c084fc); 
            border-radius: 10px;
            border: 2px solid #f1f5f9;
        }

        .stage-content { display: none; width: 100%; height: 100%; animation: zoomIn 0.3s ease-out; }
        .stage-content.active { display: flex; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡∏µ */
        .choice-btn {
            @apply relative overflow-hidden p-6 rounded-[2rem] font-black transition-all active:scale-95 shadow-xl text-2xl text-center text-white border-b-[6px] border-black/20 min-h-[110px] flex items-center justify-center;
        }
        
        /* ‡πÄ‡∏â‡∏î‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏î‡πÉ‡∏™‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° */
        .choice-0 { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .choice-1 { background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); }
        .choice-2 { background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); }
        .choice-3 { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }

        .choice-btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .choice-btn:disabled { filter: grayscale(0.5); opacity: 0.6; transform: none; }

        .podium-base { @apply w-full rounded-t-3xl shadow-2xl flex items-center justify-center text-white font-black; }
    </style>
</head>
<body>

    <div class="glass overflow-hidden border-4 border-white/20">
        <header class="p-6 border-b bg-white/50 backdrop-blur-md flex justify-between items-center shrink-0">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 p-3 rounded-2xl text-white">
                    <i data-lucide="award" class="w-8 h-8"></i>
                </div>
                <h1 class="text-3xl font-black text-indigo-950">‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ <span class="text-indigo-500">ULTIMATE</span></h1>
            </div>
            <div id="header-scores" class="flex gap-2 overflow-x-auto no-scrollbar max-w-[50%]"></div>
        </header>

        <main class="flex-1 flex flex-col overflow-hidden">
            
            <div id="stage-start" class="stage-content active flex-col items-center justify-center p-12">
                <div class="bg-indigo-50 p-12 rounded-[3rem] border-4 border-indigo-100 text-center mb-10 w-full max-w-4xl">
                    <h2 class="text-6xl font-black text-indigo-900 mb-4">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô</h2>
                    <p class="text-2xl text-indigo-400 font-bold uppercase tracking-[0.3em]">Thai Idiom Master</p>
                </div>
                <div class="flex gap-6 w-full max-w-2xl">
                    <button onclick="initGame('single')" class="flex-1 bg-white border-4 border-indigo-100 py-8 rounded-[2.5rem] text-3xl font-black text-indigo-600 shadow-xl hover:bg-indigo-50 transition-all flex items-center justify-center gap-3">
                        <i data-lucide="user"></i> ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß
                    </button>
                    <button onclick="initGame('team')" class="flex-1 bg-indigo-600 py-8 rounded-[2.5rem] text-3xl font-black text-white shadow-xl hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                        <i data-lucide="users"></i> ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡∏°
                    </button>
                </div>
            </div>

            <div id="stage-quiz" class="stage-content flex-col p-6 overflow-hidden">
                <div class="flex justify-between items-center mb-6 shrink-0">
                    <div class="bg-indigo-900 text-white px-8 py-3 rounded-2xl font-black text-2xl shadow-lg" id="q-counter">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1</div>
                    <div class="flex items-center gap-3 text-rose-600">
                        <i data-lucide="clock-8" class="w-10 h-10"></i>
                        <span id="timer-val" class="text-5xl font-black tabular-nums">60</span>
                    </div>
                </div>

                <div class="bg-white rounded-[40px] p-10 shadow-2xl border-l-[16px] border-indigo-600 mb-8 shrink-0 relative">
                    <span class="text-indigo-300 font-black text-sm uppercase mb-2 block">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏ß‡∏ô:</span>
                    <h3 id="q-text" class="text-3xl md:text-5xl font-black text-slate-800 leading-tight"></h3>
                    <div id="current-player" class="absolute -top-4 right-8 px-6 py-2 rounded-full shadow-lg font-black text-white text-sm border-2 border-white"></div>
                </div>

                <div class="flex-1 overflow-y-auto custom-scroll pr-4 pb-12">
                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-6xl mx-auto">
                        </div>
                </div>
            </div>

            <div id="stage-result" class="stage-content flex-col items-center justify-center p-10">
                <h2 class="text-6xl font-black text-indigo-900 mb-12 italic">üèÜ LEADERBOARD</h2>
                <div id="podium-wrap" class="flex items-end justify-center gap-4 w-full max-w-4xl h-72 mb-12"></div>
                <button onclick="location.reload()" class="bg-indigo-600 text-white px-16 py-6 rounded-full font-black text-3xl hover:scale-105 transition-all shadow-2xl flex items-center gap-4">
                    <i data-lucide="rotate-ccw" class="w-10 h-10"></i> ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
                </button>
            </div>

        </main>
    </div>

    <script>
        const idiomsLibrary = [
            { name: "‡∏Å‡∏á‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô", hint: "‡πÄ‡∏ß‡∏£‡∏ò‡∏£‡∏£‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏ô‡∏≠‡∏á ‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏¢‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô" },
            { name: "‡∏Å‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏¢", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏≥‡∏ö‡∏≤‡∏Å" },
            { name: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏π‡∏°", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏Å‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á" },
            { name: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏á‡∏π‡πÑ‡∏°‡πà‡∏û‡πâ‡∏ô‡∏Ñ‡∏≠", hint: "‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏•‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î" },
            { name: "‡∏Ç‡∏¥‡∏á‡∏Å‡πá‡∏£‡∏≤ ‡∏Ç‡πà‡∏≤‡∏Å‡πá‡πÅ‡∏£‡∏á", hint: "‡∏ï‡πà‡∏≤‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏£‡πâ‡∏≠‡∏ô‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô" },
            { name: "‡∏Ç‡∏µ‡πà‡∏ä‡πâ‡∏≤‡∏á‡∏à‡∏±‡∏ö‡∏ï‡∏±‡πä‡∏Å‡πÅ‡∏ï‡∏ô", hint: "‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏•‡∏á‡πÅ‡∏£‡∏á‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢" },
            { name: "‡∏î‡∏¥‡∏ô‡∏û‡∏≠‡∏Å‡∏´‡∏≤‡∏á‡∏´‡∏°‡∏π", hint: "‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡πà‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏ô‡∏ó‡∏≥‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á" },
            { name: "‡∏ô‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏ï‡∏±‡∏Å", hint: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏µ‡∏ö‡∏Ñ‡∏ß‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà" },
            { name: "‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏ï‡∏≤‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡∏≤‡∏Å", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á" },
            { name: "‡∏ß‡∏±‡∏ß‡∏´‡∏≤‡∏¢‡∏•‡πâ‡∏≠‡∏°‡∏Ñ‡∏≠‡∏Å", hint: "‡∏Ñ‡∏¥‡∏î‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß" },
            { name: "‡∏ô‡∏Å‡∏™‡∏≠‡∏á‡∏´‡∏±‡∏ß", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏ß‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå" },
            { name: "‡∏à‡∏±‡∏ö‡∏õ‡∏•‡∏≤‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏∏‡πà‡∏á‡∏´‡∏ß‡∏±‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏™‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á" },
            { name: "‡∏ä‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏≤‡πÉ‡∏ö‡∏ö‡∏±‡∏ß‡∏õ‡∏¥‡∏î", hint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏õ‡∏Å‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏°‡πà‡∏°‡∏¥‡∏î" },
            { name: "‡∏õ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏Ç‡∏¢‡∏¥‡∏ö", hint: "‡∏û‡∏π‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏≠‡∏µ‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏ß‡πâ" },
            { name: "‡∏™‡∏µ‡πà‡∏ï‡∏µ‡∏ô‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏≤‡∏î ‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏≤‡∏ä‡∏ç‡πå‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏±‡πâ‡∏á", hint: "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏¢‡πà‡∏≠‡∏°‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏à" }
        ];

        let groups = [
            { name: "‡∏ó‡∏µ‡∏°‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤", score: 0, color: "bg-blue-500" },
            { name: "‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏•‡∏¥‡∏á‡∏ô‡∏¥‡∏•", score: 0, color: "bg-rose-500" },
            { name: "‡∏ó‡∏µ‡∏°‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå‡∏Ç‡∏≤‡∏ß", score: 0, color: "bg-emerald-500" }
        ];

        let gameMode = 'single', activeGroupIdx = null, currentQ = 0, timeLeft = 60, timer = null, quizPool = [];

        function switchTab(id) {
            document.querySelectorAll('.stage-content').forEach(s => s.classList.remove('active'));
            document.getElementById('stage-' + id).classList.add('active');
            lucide.createIcons();
        }

        function initGame(mode) {
            gameMode = mode;
            currentQ = 0;
            groups.forEach(g => g.score = 0);
            quizPool = [...idiomsLibrary].sort(() => Math.random() - 0.5).slice(0, 10);
            startQuiz();
        }

        function startQuiz() {
            if(currentQ >= 10) { endShow(); return; }
            const q = quizPool[currentQ];
            document.getElementById('q-counter').innerText = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentQ + 1}/10`;
            document.getElementById('q-text').innerText = q.hint;
            
            // ‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏≠‡∏ö
            if(gameMode === 'team') {
                activeGroupIdx = currentQ % groups.length;
                const playerInd = document.getElementById('current-player');
                playerInd.innerText = `‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏Ç‡∏≠‡∏á: ${groups[activeGroupIdx].name}`;
                playerInd.style.backgroundColor = getComputedStyle(document.querySelector('.'+groups[activeGroupIdx].color)).backgroundColor;
            } else {
                document.getElementById('current-player').innerText = "SINGLE MODE";
                document.getElementById('current-player').style.backgroundColor = "#4338ca";
            }

            let options = [q.name, ...idiomsLibrary.filter(i => i.name !== q.name).sort(() => Math.random() - 0.5).slice(0, 3).map(i => i.name)].sort(() => Math.random() - 0.5);

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = `choice-btn choice-${i}`;
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.name);
                container.appendChild(btn);
            });

            switchTab('quiz');
            startTimer();
        }

        function startTimer() {
            clearInterval(timer);
            timeLeft = 60;
            const txt = document.getElementById('timer-val');
            timer = setInterval(() => {
                timeLeft -= 1;
                txt.innerText = timeLeft;
                if(timeLeft <= 0) checkAnswer(null, quizPool[currentQ].name);
            }, 1000);
        }

        function checkAnswer(sel, cor) {
            clearInterval(timer);
            const btns = document.querySelectorAll('.choice-btn');
            btns.forEach(b => {
                b.disabled = true;
                if(b.innerText === cor) {
                    b.style.background = "linear-gradient(135deg, #10b981 0%, #064e3b 100%)";
                    b.style.transform = "scale(1.05)";
                } else if(b.innerText === sel) {
                    b.style.background = "linear-gradient(135deg, #ef4444 0%, #7f1d1d 100%)";
                }
            });

            if(sel === cor) {
                if(gameMode === 'team') groups[activeGroupIdx].score += timeLeft;
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }

            currentQ++;
            setTimeout(() => {
                updateScoreHeader();
                startQuiz();
            }, 1500);
        }

        function updateScoreHeader() {
            const h = document.getElementById('header-scores');
            h.innerHTML = '';
            [...groups].sort((a,b) => b.score - a.score).forEach(g => {
                h.innerHTML += `<div class="${g.color} text-white px-5 py-2 rounded-xl text-sm font-black flex items-center gap-2 shadow-lg whitespace-nowrap">
                    ${g.name}: ${g.score}
                </div>`;
            });
        }

        function endShow() {
            switchTab('result');
            const wrap = document.getElementById('podium-wrap');
            wrap.innerHTML = '';
            let sorted = [...groups].sort((a,b) => b.score - a.score);
            
            [sorted[1], sorted[0], sorted[2]].forEach((team, i) => {
                if(!team) return;
                const rank = sorted.indexOf(team) + 1;
                const h = rank === 1 ? '100%' : rank === 2 ? '70%' : '45%';
                wrap.innerHTML += `
                    <div class="flex-1 flex flex-col items-center justify-end h-full">
                        <div class="text-2xl font-black text-indigo-600 mb-2">${team.score}</div>
                        <div class="podium-base rank-${rank} w-full bg-indigo-900" style="height: ${h}; opacity: ${1.2 - rank*0.2}">
                            <span class="text-4xl font-black">${rank}</span>
                        </div>
                        <span class="text-xs font-bold mt-2">${team.name}</span>
                    </div>`;
            });
            confetti({ particleCount: 500, spread: 120, origin: { y: 0.5 } });
        }

        window.onload = () => { lucide.createIcons(); updateScoreHeader(); };
    </script>
</body>
</html>
