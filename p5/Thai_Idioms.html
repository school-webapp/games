<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ - Pro Dashboard v5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; margin: 0;
        }
        .glass {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        .tool-btn {
            @apply flex flex-col items-center justify-center p-2 rounded-2xl transition-all duration-300 shrink-0;
        }
        .tool-btn.active {
            @apply bg-indigo-600 text-white shadow-lg scale-110;
        }
        .tool-btn:not(.active) {
            @apply text-gray-400 hover:bg-indigo-50 hover:text-indigo-600;
        }
        .stage-content {
            display: none; width: 100%; height: 100%;
            animation: slideUp 0.3s ease-out;
        }
        .stage-content.active { display: flex; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #drawing-canvas { touch-action: none; cursor: crosshair; }
        .choice-btn {
            @apply p-4 border-2 rounded-2xl font-black transition-all active:scale-95 shadow-sm text-sm md:text-base text-left relative overflow-hidden bg-white hover:bg-indigo-50 border-indigo-50;
        }
        .timer-progress { transition: width 0.1s linear; }
        
        /* Podium System */
        .podium-item {
            @apply flex flex-col items-center justify-end transition-all duration-1000 ease-out flex-1;
            min-width: 80px;
        }
        .podium-base {
            @apply w-full rounded-t-2xl flex flex-col items-center justify-center text-white font-black shadow-lg relative;
            transition: height 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        /* Dynamic Podium Colors */
        .rank-1 { @apply bg-gradient-to-b from-yellow-300 to-yellow-600; }
        .rank-2 { @apply bg-gradient-to-b from-slate-300 to-slate-500; }
        .rank-3 { @apply bg-gradient-to-b from-orange-400 to-orange-700; }
        
        .crown-icon {
            @apply absolute -top-12 text-5xl animate-bounce;
        }
    </style>
</head>
<body class="p-2 md:p-4">

    <div class="glass w-full max-w-5xl h-[95vh] flex flex-col overflow-hidden relative border border-white/20">
        
        <header class="p-4 border-b flex flex-col md:flex-row justify-between items-center bg-white/80 backdrop-blur-md z-10 shrink-0 gap-3">
            <div class="flex items-center gap-3 shrink-0">
                <div class="bg-indigo-600 p-2 rounded-xl text-white shadow-lg">
                    <i data-lucide="graduation-cap"></i>
                </div>
                <div>
                    <h1 class="text-lg font-black text-indigo-900 leading-none">‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</h1>
                    <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mt-1">Classroom Ultimate v5.0</p>
                </div>
            </div>

            <div id="header-group-scores" class="flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-2 bg-indigo-50/50 rounded-2xl border border-indigo-100 max-w-full"></div>

            <div class="flex items-center gap-4 border-l pl-4 shrink-0">
                <div class="text-right">
                    <span class="block text-[10px] text-gray-400 font-bold uppercase leading-none mb-1" id="mode-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                    <span id="global-game-score" class="text-xl font-black text-indigo-600 leading-none">0</span>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-hidden relative bg-gray-50/30">
            
            <div id="stage-play" class="stage-content active flex-col items-center p-4 md:p-8 overflow-y-auto">
                
                <div id="start-area" class="text-center space-y-8 my-auto">
                    <div class="text-8xl md:text-9xl animate-bounce">üêò</div>
                    <h2 class="text-3xl md:text-4xl font-black text-gray-800">‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≤‡∏Å Emoji</h2>
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <button onclick="initMode('single')" class="bg-white border-2 border-indigo-100 text-indigo-600 px-10 py-5 rounded-3xl text-xl font-black shadow-lg hover:border-indigo-600 transition-all">‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</button>
                        <button onclick="initMode('team')" class="bg-indigo-600 text-white px-10 py-5 rounded-3xl text-xl font-black shadow-xl hover:bg-indigo-700 transition-all">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°</button>
                    </div>
                </div>

                <div id="team-turn-area" class="text-center space-y-8 hidden my-auto w-full max-w-2xl">
                    <h2 class="text-3xl font-black">‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏î?</h2>
                    <div id="team-selector-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
                </div>

                <div id="quiz-area" class="w-full max-w-2xl hidden py-2">
                    <div class="flex justify-between items-center mb-3">
                        <span id="q-num-text" class="text-indigo-600 font-black text-xs bg-indigo-50 px-3 py-1 rounded-full">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 01/10</span>
                        <div class="flex items-center gap-2 text-red-500">
                            <i data-lucide="clock"></i>
                            <span id="timer-text" class="text-2xl font-black">60</span>
                        </div>
                    </div>
                    
                    <div class="w-full bg-gray-200 h-2 rounded-full mb-8 overflow-hidden">
                        <div id="timer-bar" class="timer-progress h-full bg-red-500" style="width: 100%"></div>
                    </div>

                    <div class="mb-8 bg-white p-12 rounded-[40px] shadow-sm border border-indigo-50 text-center">
                        <div id="q-emoji" class="text-[100px] md:text-[120px] drop-shadow-xl animate-pulse">üí°</div>
                        <p id="turn-indicator" class="mt-6 font-bold text-indigo-400"></p>
                    </div>
                    
                    <div id="options-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full"></div>
                </div>

                <div id="result-area" class="w-full hidden flex-col items-center py-6 my-auto">
                    <h2 class="text-5xl font-black text-indigo-900 mb-12 text-center italic">CONGRATULATIONS!</h2>
                    
                    <div id="podium-container" class="flex items-end justify-center gap-2 sm:gap-6 w-full max-w-4xl h-80 mb-12 px-4">
                        </div>

                    <button onclick="resetGame()" class="bg-indigo-600 text-white px-12 py-4 rounded-2xl font-black shadow-xl hover:scale-105 transition-all">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                </div>
            </div>

            <div id="stage-board" class="stage-content flex-col bg-white">...</div>
            <div id="stage-scores" class="stage-content flex-col p-4 md:p-8 items-center overflow-y-auto">
                <div class="w-full max-w-lg bg-white rounded-[40px] p-6 shadow-sm border my-auto">
                    <h3 class="text-2xl font-black mb-6">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</h3>
                    <div id="groups-list" class="space-y-2 mb-6"></div>
                    <div class="flex gap-2 bg-indigo-50 p-2 rounded-2xl">
                        <input type="text" id="new-group-input" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°..." class="flex-1 bg-transparent px-4 outline-none font-bold">
                        <button onclick="addGroup()" class="bg-indigo-600 text-white px-5 py-2 rounded-2xl font-bold">+</button>
                    </div>
                </div>
            </div>
            <div id="stage-random" class="stage-content">...</div>
        </main>

        <nav class="p-4 bg-white border-t flex justify-around items-center shrink-0">
            <button onclick="switchTab('play')" id="tab-play" class="tool-btn active"><i data-lucide="gamepad-2"></i><span class="text-[9px] font-black mt-1">PLAY</span></button>
            <button onclick="switchTab('scores')" id="tab-scores" class="tool-btn"><i data-lucide="trophy"></i><span class="text-[9px] font-black mt-1">TEAMS</span></button>
        </nav>
    </div>

    <script>
        const idiomsData = [
            { name: "‡∏Å‡∏á‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô", emoji: "üé°" },
            { name: "‡∏Å‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏¢", emoji: "üê∏" },
            { name: "‡∏Å‡∏ö‡πÉ‡∏ô‡∏Å‡∏∞‡∏•‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö", emoji: "üêö" },
            { name: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏π‡∏°", emoji: "üê∞" },
            { name: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏á‡∏π‡πÑ‡∏°‡πà‡∏û‡πâ‡∏ô‡∏Ñ‡∏≠", emoji: "üêç" },
            { name: "‡∏Ç‡∏¥‡∏á‡∏Å‡πá‡∏£‡∏≤ ‡∏Ç‡πà‡∏≤‡∏Å‡πá‡πÅ‡∏£‡∏á", emoji: "üå∂Ô∏è" },
            { name: "‡∏Ç‡∏µ‡πà‡∏ä‡πâ‡∏≤‡∏á‡∏à‡∏±‡∏ö‡∏ï‡∏±‡πä‡∏Å‡πÅ‡∏ï‡∏ô", emoji: "üêò" },
            { name: "‡∏î‡∏¥‡∏ô‡∏û‡∏≠‡∏Å‡∏´‡∏≤‡∏á‡∏´‡∏°‡∏π", emoji: "üê∑" },
            { name: "‡∏ô‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏ï‡∏±‡∏Å", emoji: "üåä" },
            { name: "‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏ï‡∏≤‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡∏≤‡∏Å", emoji: "üëÑ" },
            { name: "‡∏ß‡∏±‡∏ß‡∏´‡∏≤‡∏¢‡∏•‡πâ‡∏≠‡∏°‡∏Ñ‡∏≠‡∏Å", emoji: "üêÑ" },
            { name: "‡πÑ‡∏Å‡πà‡πÄ‡∏´‡πá‡∏ô‡∏ï‡∏µ‡∏ô‡∏á‡∏π ‡∏á‡∏π‡πÄ‡∏´‡πá‡∏ô‡∏ô‡∏°‡πÑ‡∏Å‡πà", emoji: "üêî" }
        ];

        let groups = [
            {name: "‡∏ó‡∏µ‡∏°‡∏°‡∏±‡∏á‡∏Å‡∏£", score: 0, color: "bg-rose-500"}, 
            {name: "‡∏ó‡∏µ‡∏°‡∏´‡∏á‡∏™‡πå", score: 0, color: "bg-sky-500"},
            {name: "‡∏ó‡∏µ‡∏°‡∏™‡∏¥‡∏á‡πÇ‡∏ï", score: 0, color: "bg-emerald-500"}
        ];

        let currentIdx = 0, gameScore = 0, timeLeft = 60, timerId = null, quizPool = [];
        let gameMode = 'single', activeGroupIdx = null;

        function switchTab(tabId) {
            document.querySelectorAll('.stage-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tool-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`stage-${tabId}`).classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
            lucide.createIcons();
        }

        function initMode(mode) {
            gameMode = mode;
            currentIdx = 0;
            quizPool = [...idiomsData].sort(() => Math.random() - 0.5).slice(0, 10);
            document.getElementById('start-area').classList.add('hidden');
            if(mode === 'team') showTeamTurnSelector(); else startActualQuiz();
        }

        function showTeamTurnSelector() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('team-turn-area').classList.remove('hidden');
            const grid = document.getElementById('team-selector-grid');
            grid.innerHTML = '';
            groups.forEach((g, i) => {
                const b = document.createElement('button');
                b.className = `${g.color} text-white p-6 rounded-2xl font-black shadow-lg hover:scale-105 transition-all`;
                b.innerHTML = `<div>${g.name}</div><div class="text-xs opacity-70">${g.score} Pts</div>`;
                b.onclick = () => { activeGroupIdx = i; startActualQuiz(); };
                grid.appendChild(b);
            });
        }

        function startActualQuiz() {
            document.getElementById('team-turn-area').classList.add('hidden');
            document.getElementById('quiz-area').classList.remove('hidden');
            loadQuiz();
        }

        function loadQuiz() {
            if(currentIdx >= 10) { endQuiz(); return; }
            const q = quizPool[currentIdx];
            document.getElementById('q-num-text').innerText = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentIdx+1}/10`;
            document.getElementById('q-emoji').innerText = q.emoji;
            
            if(gameMode === 'team') {
                document.getElementById('turn-indicator').innerText = `‡∏ñ‡∏∂‡∏á‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á: ${groups[activeGroupIdx].name}`;
            }

            let opts = [q.name];
            let others = idiomsData.filter(i => i.name !== q.name).sort(() => Math.random() - 0.5);
            opts.push(...others.slice(0, 3).map(i => i.name));
            opts.sort(() => Math.random() - 0.5);

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            opts.forEach(opt => {
                const b = document.createElement('button');
                b.className = "choice-btn";
                b.innerText = opt;
                b.onclick = () => checkAns(opt, q.name);
                grid.appendChild(b);
            });
            startT();
        }

        function startT() {
            clearInterval(timerId); timeLeft = 60;
            timerId = setInterval(() => {
                timeLeft -= 0.1;
                document.getElementById('timer-text').innerText = Math.ceil(timeLeft);
                document.getElementById('timer-bar').style.width = (timeLeft/60*100) + "%";
                if(timeLeft <= 0) checkAns(null, quizPool[currentIdx].name);
            }, 100);
        }

        function checkAns(sel, cor) {
            clearInterval(timerId);
            if(sel === cor) {
                let pts = Math.ceil(timeLeft);
                if(gameMode === 'team') groups[activeGroupIdx].score += pts;
                else gameScore += pts;
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });
            }
            
            currentIdx++;
            setTimeout(() => {
                if(gameMode === 'team' && currentIdx < 10) showTeamTurnSelector();
                else loadQuiz();
                renderHeader();
            }, 1000);
        }

        function endQuiz() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            
            const container = document.getElementById('podium-container');
            container.innerHTML = '';

            // Sort groups by score
            let sorted = [...groups].sort((a, b) => b.score - a.score);
            
            // Assign ranks (Handle ties)
            let currentRank = 1;
            sorted.forEach((team, i) => {
                if (i > 0 && team.score < sorted[i-1].score) currentRank = i + 1;
                team.rank = currentRank;
            });

            // Re-order for visual display: 2nd, 1st, 3rd
            let visualOrder = [];
            const firsts = sorted.filter(t => t.rank === 1);
            const seconds = sorted.filter(t => t.rank === 2);
            const thirds = sorted.filter(t => t.rank === 3);

            // Logic to build a balanced podium
            visualOrder = [...seconds, ...firsts, ...thirds];

            visualOrder.forEach(team => {
                const item = document.createElement('div');
                item.className = "podium-item";
                
                // Set height based on rank
                let h = "60px";
                if(team.rank === 1) h = "180px";
                else if(team.rank === 2) h = "130px";
                else if(team.rank === 3) h = "90px";

                item.innerHTML = `
                    <div class="mb-2 text-center relative w-full">
                        ${team.rank === 1 ? '<div class="crown-icon">üëë</div>' : ''}
                        <div class="font-black text-xs truncate px-1">${team.name}</div>
                        <div class="text-indigo-600 font-bold text-sm">${team.score}</div>
                    </div>
                    <div class="podium-base rank-${team.rank}" style="height: ${h}">
                        <span class="text-3xl">${team.rank}</span>
                    </div>
                `;
                container.appendChild(item);
            });

            confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
        }

        function renderHeader() {
            const h = document.getElementById('header-group-scores');
            h.innerHTML = '';
            [...groups].sort((a,b) => b.score - a.score).forEach(g => {
                const b = document.createElement('div');
                b.className = `${g.color} px-3 py-1 rounded-full text-white text-[10px] font-bold flex items-center gap-2 shadow-sm`;
                b.innerHTML = `<span>${g.name}</span><span class="bg-black/20 px-2 rounded-full">${g.score}</span>`;
                h.appendChild(b);
            });
            document.getElementById('global-game-score').innerText = gameScore;
        }

        function addGroup() {
            const val = document.getElementById('new-group-input').value;
            if(!val) return;
            groups.push({name: val, score: 0, color: "bg-indigo-500"});
            document.getElementById('new-group-input').value = '';
            renderScores();
        }

        function renderScores() {
            const list = document.getElementById('groups-list');
            list.innerHTML = '';
            groups.forEach((g, i) => {
                const row = document.createElement('div');
                row.className = "flex justify-between items-center p-3 bg-gray-50 rounded-xl border";
                row.innerHTML = `<span class="font-bold">${g.name}</span>
                    <div class="flex gap-2 items-center">
                        <button onclick="groups[${i}].score-=10;renderScores();renderHeader()" class="w-8 h-8 bg-white border rounded">-</button>
                        <span class="w-8 text-center font-black">${g.score}</span>
                        <button onclick="groups[${i}].score+=10;renderScores();renderHeader()" class="w-8 h-8 bg-white border rounded">+</button>
                    </div>`;
                list.appendChild(row);
            });
        }

        function resetGame() {
            groups.forEach(g => g.score = 0);
            gameScore = 0;
            currentIdx = 0;
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('start-area').classList.remove('hidden');
            renderHeader();
        }

        window.onload = () => { lucide.createIcons(); renderHeader(); renderScores(); };
    </script>
</body>
</html>
