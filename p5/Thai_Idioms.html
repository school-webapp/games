<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏õ‡∏£‡∏∞‡∏•‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤ ‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ Ultimate v5.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex; align-items: center; justify-content: center;
            margin: 0; padding: 10px; overflow: hidden;
        }
        .glass {
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(15px);
            border-radius: 32px;
            width: 95vw; height: 95vh;
            display: flex; flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        /* ‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏£‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb { 
            background: linear-gradient(to bottom, #6366f1, #a855f7); 
            border-radius: 10px; 
        }

        .stage-content { display: none; width: 100%; height: 100%; animation: fadeIn 0.4s ease-out; }
        .stage-content.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏î‡πÉ‡∏™ */
        .choice-btn {
            @apply relative overflow-hidden p-6 border-b-8 rounded-3xl font-black transition-all active:scale-95 active:border-b-0 shadow-lg text-2xl text-center bg-white min-h-[100px] flex items-center justify-center;
        }
        .choice-0 { @apply border-amber-500 text-amber-700 hover:bg-amber-50; }
        .choice-1 { @apply border-cyan-500 text-cyan-700 hover:bg-cyan-50; }
        .choice-2 { @apply border-rose-500 text-rose-700 hover:bg-rose-50; }
        .choice-3 { @apply border-emerald-500 text-emerald-700 hover:bg-emerald-50; }

        .podium-base {
            @apply w-full rounded-t-[3rem] flex flex-col items-center justify-center text-white font-black shadow-2xl relative transition-all duration-1000;
        }
    </style>
</head>
<body>

    <div class="glass overflow-hidden border border-white/30">
        <header class="p-5 border-b bg-white/80 flex justify-between items-center z-10 shrink-0">
            <div class="flex items-center gap-4">
                <div class="bg-gradient-to-br from-indigo-600 to-purple-600 p-3 rounded-2xl text-white shadow-lg">
                    <i data-lucide="sparkles" class="w-8 h-8"></i>
                </div>
                <h1 class="text-2xl font-black bg-clip-text text-transparent bg-gradient-to-r from-indigo-900 to-purple-700">‡∏õ‡∏£‡∏∞‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ v5.5</h1>
            </div>
            <div id="header-scores" class="flex gap-3 overflow-x-auto no-scrollbar py-2"></div>
        </header>

        <main class="flex-1 relative overflow-hidden flex flex-col">
            
            <div id="stage-start" class="stage-content active flex-col items-center justify-center p-10">
                <div class="text-center mb-12">
                    <h2 class="text-7xl font-black text-indigo-900 mb-4 drop-shadow-sm">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h2>
                    <p class="text-2xl text-slate-500 font-medium">‡∏°‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-3xl">
                    <button onclick="initGame('single')" class="bg-white border-4 border-slate-100 p-10 rounded-[3rem] shadow-xl hover:border-indigo-400 transition-all group">
                        <i data-lucide="user" class="w-16 h-16 mx-auto mb-4 text-indigo-500 group-hover:scale-110 transition-transform"></i>
                        <span class="text-3xl font-black text-slate-700">‡∏•‡∏∏‡∏¢‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß</span>
                    </button>
                    <button onclick="initGame('team')" class="bg-indigo-600 p-10 rounded-[3rem] shadow-xl hover:bg-indigo-700 transition-all group">
                        <i data-lucide="users" class="w-16 h-16 mx-auto mb-4 text-white group-hover:scale-110 transition-transform"></i>
                        <span class="text-3xl font-black text-white">‡∏¢‡∏Å‡∏û‡∏ß‡∏Å‡∏°‡∏≤</span>
                    </button>
                </div>
            </div>

            <div id="stage-team-select" class="stage-content flex-col items-center p-10">
                <h2 class="text-4xl font-black text-indigo-900 mb-8">‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡∏à‡∏∞‡∏ï‡∏≠‡∏ö?</h2>
                <div id="team-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-5xl overflow-y-auto custom-scroll p-4"></div>
            </div>

            <div id="stage-quiz" class="stage-content flex-col p-6 overflow-hidden">
                <div class="flex justify-between items-center mb-4 shrink-0">
                    <div class="bg-slate-800 text-white px-6 py-2 rounded-2xl font-black text-xl" id="q-counter">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1/10</div>
                    <div id="timer-text" class="text-4xl font-black tabular-nums text-rose-500 flex items-center gap-2">
                        <i data-lucide="timer" class="w-8 h-8"></i> <span id="timer-val">60</span>
                    </div>
                </div>

                <div class="bg-white rounded-[40px] p-8 shadow-xl border-t-8 border-indigo-500 mb-6 shrink-0 relative">
                    <p class="text-indigo-400 font-bold uppercase tracking-widest text-xs mb-2 text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠...</p>
                    <h3 id="q-text" class="text-3xl md:text-5xl font-black text-slate-800 text-center leading-tight"></h3>
                    <div id="current-player" class="absolute -bottom-5 left-1/2 -translate-x-1/2 px-8 py-2 rounded-full shadow-lg font-bold text-white text-lg border-2 border-white"></div>
                </div>

                <div id="options-scroll-area" class="flex-1 overflow-y-auto custom-scroll px-4 pb-8">
                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-5 max-w-6xl mx-auto">
                        </div>
                </div>
            </div>

            <div id="stage-result" class="stage-content flex-col items-center justify-center p-10">
                <div id="podium-wrap" class="flex items-end justify-center gap-6 w-full max-w-4xl h-80 mb-16"></div>
                <button onclick="location.reload()" class="bg-slate-900 text-white px-12 py-5 rounded-3xl font-black text-2xl hover:scale-105 transition-all shadow-2xl flex items-center gap-4">
                    <i data-lucide="refresh-cw"></i> ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
            </div>

        </main>
    </div>

    <script>
        // ‡πÉ‡∏ä‡πâ Data ‡πÅ‡∏•‡∏∞ Logic ‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å v5.4
        const idiomsLibrary = [
            { name: "‡∏Å‡∏á‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô", hint: "‡πÄ‡∏ß‡∏£‡∏ò‡∏£‡∏£‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏ô‡∏≠‡∏á ‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏¢‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô" },
            { name: "‡∏Å‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏¢", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏≥‡∏ö‡∏≤‡∏Å" },
            { name: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏π‡∏°", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏Å‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á" },
            { name: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏á‡∏π‡πÑ‡∏°‡πà‡∏û‡πâ‡∏ô‡∏Ñ‡∏≠", hint: "‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏•‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î" },
            { name: "‡∏Ç‡∏¥‡∏á‡∏Å‡πá‡∏£‡∏≤ ‡∏Ç‡πà‡∏≤‡∏Å‡πá‡πÅ‡∏£‡∏á", hint: "‡∏ï‡πà‡∏≤‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏£‡πâ‡∏≠‡∏ô‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô" },
            { name: "‡∏Ç‡∏µ‡πà‡∏ä‡πâ‡∏≤‡∏á‡∏à‡∏±‡∏ö‡∏ï‡∏±‡πä‡∏Å‡πÅ‡∏ï‡∏ô", hint: "‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏•‡∏á‡πÅ‡∏£‡∏á‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢" },
            { name: "‡∏î‡∏¥‡∏ô‡∏û‡∏≠‡∏Å‡∏´‡∏≤‡∏á‡∏´‡∏°‡∏π", hint: "‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡πà‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏ô‡∏ó‡∏≥‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á" },
            { name: "‡∏ô‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏ï‡∏±‡∏Å", hint: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏µ‡∏ö‡∏Ñ‡∏ß‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà" },
            { name: "‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏ï‡∏≤‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡∏≤‡∏Å", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á" },
            { name: "‡∏ß‡∏±‡∏ß‡∏´‡∏≤‡∏¢‡∏•‡πâ‡∏≠‡∏°‡∏Ñ‡∏≠‡∏Å", hint: "‡∏Ñ‡∏¥‡∏î‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß" },
            { name: "‡∏ô‡∏Å‡∏™‡∏≠‡∏á‡∏´‡∏±‡∏ß", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏ß‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå" },
            { name: "‡∏à‡∏±‡∏ö‡∏õ‡∏•‡∏≤‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏∏‡πà‡∏á‡∏´‡∏ß‡∏±‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏™‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á" },
            { name: "‡∏ä‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏≤‡πÉ‡∏ö‡∏ö‡∏±‡∏ß‡∏õ‡∏¥‡∏î", hint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏õ‡∏Å‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏°‡πà‡∏°‡∏¥‡∏î" },
            { name: "‡∏õ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏Ç‡∏¢‡∏¥‡∏ö", hint: "‡∏û‡∏π‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏≠‡∏µ‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏ß‡πâ" },
            { name: "‡∏™‡∏µ‡πà‡∏ï‡∏µ‡∏ô‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏≤‡∏î ‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏≤‡∏ä‡∏ç‡πå‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏±‡πâ‡∏á", hint: "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏¢‡πà‡∏≠‡∏°‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏à" }
        ];

        let groups = [
            { name: "‡∏ó‡∏µ‡∏°‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤", score: 0, color: "bg-blue-500" },
            { name: "‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏•‡∏¥‡∏á‡∏ô‡∏¥‡∏•", score: 0, color: "bg-rose-500" },
            { name: "‡∏ó‡∏µ‡∏°‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå‡∏Ç‡∏≤‡∏ß", score: 0, color: "bg-emerald-500" }
        ];

        let gameMode = 'single', activeGroupIdx = null, currentQ = 0, timeLeft = 60, timer = null, quizPool = [];

        function switchTab(id) {
            document.querySelectorAll('.stage-content').forEach(s => s.classList.remove('active'));
            document.getElementById('stage-' + id).classList.add('active');
            lucide.createIcons();
        }

        function initGame(mode) {
            gameMode = mode;
            currentQ = 0;
            groups.forEach(g => g.score = 0);
            quizPool = [...idiomsLibrary].sort(() => Math.random() - 0.5).slice(0, 10);
            if(mode === 'team') showTeamSelect(); else startQuiz();
        }

        function showTeamSelect() {
            const grid = document.getElementById('team-grid');
            grid.innerHTML = '';
            groups.forEach((g, i) => {
                const btn = document.createElement('button');
                btn.className = `${g.color} text-white p-8 rounded-[2rem] font-black shadow-lg hover:scale-105 transition-all text-2xl`;
                btn.innerHTML = `${g.name}<br><span class="opacity-70 text-lg">${g.score} pts</span>`;
                btn.onclick = () => { activeGroupIdx = i; startQuiz(); };
                grid.appendChild(btn);
            });
            switchTab('team-select');
        }

        function startQuiz() {
            if(currentQ >= 10) { endShow(); return; }
            const q = quizPool[currentQ];
            document.getElementById('q-counter').innerText = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentQ + 1}/10`;
            document.getElementById('q-text').innerText = q.hint;
            
            const playerInd = document.getElementById('current-player');
            playerInd.innerText = gameMode === 'team' ? groups[activeGroupIdx].name : "‡πÇ‡∏´‡∏°‡∏î‡∏•‡∏∏‡∏¢‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß";
            playerInd.style.backgroundColor = gameMode === 'team' ? getComputedStyle(document.querySelector('.'+groups[activeGroupIdx].color)).backgroundColor : '#4f46e5';

            let options = [q.name, ...idiomsLibrary.filter(i => i.name !== q.name).sort(() => Math.random() - 0.5).slice(0, 3).map(i => i.name)].sort(() => Math.random() - 0.5);

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = `choice-btn choice-${i}`;
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.name);
                container.appendChild(btn);
            });

            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏£‡πå‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
            document.getElementById('options-scroll-area').scrollTop = 0;

            switchTab('quiz');
            startTimer();
        }

        function startTimer() {
            clearInterval(timer);
            timeLeft = 60;
            const txt = document.getElementById('timer-val');
            timer = setInterval(() => {
                timeLeft -= 1;
                txt.innerText = timeLeft;
                if(timeLeft <= 0) checkAnswer(null, quizPool[currentQ].name);
            }, 1000);
        }

        function checkAnswer(sel, cor) {
            clearInterval(timer);
            const btns = document.querySelectorAll('.choice-btn');
            btns.forEach(b => {
                b.disabled = true;
                if(b.innerText === cor) b.classList.add('bg-emerald-500', 'text-white', 'border-emerald-700', 'scale-105', 'z-10');
                else if(b.innerText === sel) b.classList.add('bg-rose-500', 'text-white', 'border-rose-700', 'opacity-50');
            });

            if(sel === cor) {
                if(gameMode === 'team') groups[activeGroupIdx].score += timeLeft;
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            }

            currentQ++;
            setTimeout(() => {
                updateScoreHeader();
                if(gameMode === 'team' && currentQ < 10) showTeamSelect();
                else startQuiz();
            }, 1500);
        }

        function updateScoreHeader() {
            const h = document.getElementById('header-scores');
            h.innerHTML = '';
            [...groups].sort((a,b) => b.score - a.score).forEach(g => {
                h.innerHTML += `<div class="${g.color} text-white px-4 py-1 rounded-full text-sm font-black flex items-center gap-2 shadow-md whitespace-nowrap">
                    ${g.name} <span class="bg-white/20 px-2 rounded-lg">${g.score}</span>
                </div>`;
            });
        }

        function endShow() {
            switchTab('result');
            const wrap = document.getElementById('podium-wrap');
            wrap.innerHTML = '';
            let sorted = [...groups].sort((a,b) => b.score - a.score);
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: [2, 1, 3]
            const displayOrder = [sorted[1], sorted[0], sorted[2]];
            displayOrder.forEach((team, i) => {
                if(!team) return;
                const rank = sorted.indexOf(team) + 1;
                const h = rank === 1 ? '100%' : rank === 2 ? '70%' : '45%';
                wrap.innerHTML += `
                    <div class="flex-1 flex flex-col items-center justify-end h-full">
                        <div class="text-center mb-2">
                            <span class="text-xs font-black text-slate-500 uppercase">${team.name}</span>
                            <div class="text-2xl font-black text-indigo-600">${team.score}</div>
                        </div>
                        <div class="podium-base rank-${rank} w-full" style="height: ${h}">
                            <span class="text-4xl">${rank === 1 ? 'üëë' : rank}</span>
                        </div>
                    </div>`;
            });
            confetti({ particleCount: 400, spread: 100, origin: { y: 0.5 } });
        }

        window.onload = () => { lucide.createIcons(); updateScoreHeader(); };
    </script>
</body>
</html>
