<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ - Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin: 0;
        }
        .glass {
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(12px);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
        }
        .tool-btn {
            @apply flex flex-col items-center justify-center p-3 rounded-2xl transition-all duration-300;
        }
        .tool-btn.active {
            @apply bg-indigo-600 text-white shadow-lg scale-110;
        }
        .tool-btn:not(.active) {
            @apply text-gray-400 hover:bg-indigo-50 hover:text-indigo-600;
        }
        .stage-content {
            display: none;
            animation: slideUp 0.3s ease-out;
        }
        .stage-content.active {
            display: flex;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #drawing-canvas {
            touch-action: none;
            cursor: crosshair;
        }
        .switch {
            position: relative; display: inline-block; width: 44px; height: 22px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #cbd5e1; transition: .4s; border-radius: 20px;
        }
        .slider:before {
            position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #f97316; }
        input:checked + .slider:before { transform: translateX(22px); }
        
        /* Hide scrollbar but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="p-2 md:p-4">

    <div class="glass w-full max-w-5xl h-[95vh] flex flex-col overflow-hidden relative border border-white/20">
        
        <!-- Header: Title & Group Scores -->
        <header class="p-4 border-b flex flex-col md:flex-row justify-between items-center bg-white/50 backdrop-blur-md z-10 gap-3">
            <div class="flex items-center gap-3 shrink-0">
                <div class="bg-indigo-600 p-2 rounded-xl text-white shadow-indigo-200 shadow-lg">
                    <i data-lucide="graduation-cap"></i>
                </div>
                <div>
                    <h1 class="text-lg font-black text-indigo-900 leading-none">‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</h1>
                    <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mt-1">Classroom Pro v3.0</p>
                </div>
            </div>

            <!-- Real-time Group Leaderboard on Top Bar -->
            <div id="header-group-scores" class="flex items-center gap-2 overflow-x-auto no-scrollbar py-1 px-2 bg-gray-100/50 rounded-2xl border border-gray-200/50">
                <!-- Group Badges Injected Here -->
            </div>

            <div class="hidden md:flex items-center gap-4 border-l pl-4">
                <div class="text-right">
                    <span class="block text-[10px] text-gray-400 font-bold uppercase">Game Progress</span>
                    <div class="w-24 h-2 bg-gray-200 rounded-full mt-1 overflow-hidden">
                        <div id="game-progress-bar" class="h-full bg-indigo-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-hidden relative bg-white/30">
            
            <!-- 1. Play Tool (Quiz) -->
            <div id="stage-play" class="stage-content active w-full h-full flex flex-col items-center justify-center p-4 md:p-8">
                <div id="quiz-area" class="w-full max-w-2xl text-center hidden">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex flex-col items-start">
                            <span id="q-num-text" class="text-indigo-600 font-black text-sm uppercase tracking-tighter">Question 01/10</span>
                            <div class="text-2xl font-black text-gray-800" id="current-score-display">Pts: 0</div>
                        </div>
                        <div class="flex items-center gap-2 bg-red-50 px-4 py-2 rounded-2xl border border-red-100 text-red-500">
                            <i data-lucide="timer" class="w-5 h-5 animate-pulse"></i>
                            <span id="timer-text" class="text-3xl font-black tabular-nums">20</span>
                        </div>
                    </div>
                    <div class="mb-8 bg-white p-6 md:p-10 rounded-[40px] shadow-sm border border-indigo-50 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-2 h-full bg-indigo-500"></div>
                        <div id="q-emoji" class="text-7xl mb-4 drop-shadow-sm">üí°</div>
                        <p class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-3">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏Ñ‡∏∑‡∏≠...</p>
                        <p id="q-hint" class="text-xl md:text-3xl font-extrabold text-gray-800 leading-tight"></p>
                    </div>
                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full"></div>
                </div>

                <!-- Play Welcome -->
                <div id="start-area" class="text-center space-y-8">
                    <div class="relative inline-block">
                        <div class="text-9xl animate-bounce-slow">üìö</div>
                        <div class="absolute -bottom-2 -right-2 bg-yellow-400 p-2 rounded-full shadow-lg">‚≠ê</div>
                    </div>
                    <div>
                        <h2 class="text-4xl font-black text-gray-800 mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏•‡∏≠‡∏á!</h2>
                        <p class="text-gray-500 font-medium">‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å-‡∏Æ</p>
                    </div>
                    <button onclick="startGame()" class="group bg-indigo-600 text-white px-14 py-5 rounded-3xl text-2xl font-black shadow-2xl hover:bg-indigo-700 active:scale-95 transition-all flex items-center gap-3 mx-auto">
                        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢ <i data-lucide="zap" class="fill-current"></i>
                    </button>
                </div>

                <!-- Play Results -->
                <div id="result-area" class="text-center space-y-6 hidden">
                    <div class="text-8xl">üèÖ</div>
                    <h2 class="text-4xl font-black text-gray-800">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                    <div class="bg-white px-12 py-6 rounded-[32px] inline-block shadow-xl border-4 border-indigo-50">
                        <p class="text-gray-400 font-bold text-xs uppercase mb-1">Final Score</p>
                        <p id="final-game-score" class="text-7xl font-black text-indigo-600">0</p>
                    </div>
                    <div class="flex gap-3 justify-center">
                        <button onclick="resetGame()" class="bg-indigo-600 text-white px-8 py-3 rounded-2xl font-bold hover:bg-indigo-700 transition-all">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                    </div>
                </div>
            </div>

            <!-- 2. Board Tool (Whiteboard) -->
            <div id="stage-board" class="stage-content w-full h-full flex flex-col bg-white">
                <div class="p-3 border-b flex items-center justify-between bg-gray-50/80 backdrop-blur">
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 bg-white p-1 rounded-xl border shadow-sm">
                            <input type="color" id="pen-color" value="#4f46e5" class="w-8 h-8 rounded-lg cursor-pointer border-none bg-transparent">
                            <span class="text-[10px] font-bold text-gray-400 uppercase pr-2">Pen</span>
                        </div>
                        <div class="flex items-center gap-3 bg-white p-1 px-4 rounded-xl border shadow-sm">
                            <i data-lucide="minus" class="w-3 h-3 text-gray-300"></i>
                            <input type="range" id="pen-size" min="2" max="40" value="8" class="w-24 md:w-48 accent-indigo-600">
                            <i data-lucide="plus" class="w-4 h-4 text-gray-300"></i>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="setEraser()" id="eraser-btn" class="p-2.5 rounded-xl text-gray-400 hover:bg-gray-100 transition-colors border" title="Eraser">
                            <i data-lucide="eraser"></i>
                        </button>
                        <button onclick="clearCanvas()" class="p-2.5 rounded-xl text-red-500 hover:bg-red-50 transition-colors border border-red-100" title="Clear All">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-1 relative bg-[url('https://www.transparenttextures.com/patterns/graphy.png')] bg-repeat">
                    <canvas id="drawing-canvas" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- 3. Scores Tool (Management) -->
            <div id="stage-scores" class="stage-content w-full h-full flex flex-col p-4 md:p-8 items-center overflow-y-auto">
                <div class="w-full max-w-lg bg-white rounded-[40px] p-8 shadow-sm border border-indigo-50">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h3 class="text-2xl font-black text-indigo-900">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                            <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Team Management</p>
                        </div>
                        <i data-lucide="shield-check" class="text-indigo-600 w-8 h-8"></i>
                    </div>
                    
                    <div id="groups-list" class="space-y-4 mb-8">
                        <!-- Group Items -->
                    </div>

                    <div class="flex gap-3 bg-indigo-50 p-3 rounded-3xl border border-indigo-100">
                        <input type="text" id="new-group-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà..." class="flex-1 bg-transparent px-4 py-2 outline-none font-bold text-indigo-900 placeholder:text-indigo-300">
                        <button onclick="addGroup()" class="bg-indigo-600 text-white px-6 py-2 rounded-2xl font-bold shadow-lg hover:bg-indigo-700 transition-colors">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 4. Random Tool (Dices) -->
            <div id="stage-random" class="stage-content w-full h-full flex flex-col p-4 md:p-8 items-center justify-center">
                <div class="w-full max-w-md bg-white rounded-[40px] p-10 shadow-sm border border-indigo-50 text-center relative">
                    <div class="flex justify-between items-center mb-8">
                        <div class="text-left">
                            <h3 class="text-2xl font-black text-indigo-900">‡∏™‡∏∏‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</h3>
                            <p id="random-status-text" class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Waiting for spin</p>
                        </div>
                        <div class="bg-gray-50 px-3 py-2 rounded-2xl border flex items-center gap-3">
                            <span class="text-[10px] font-black text-gray-400 uppercase">‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥</span>
                            <label class="switch">
                                <input type="checkbox" id="no-repeat" onchange="resetDrawn()">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="relative mb-10">
                        <div id="rand-display" class="text-[120px] leading-none font-black text-indigo-600 py-12 bg-gray-50 rounded-[40px] shadow-inner transition-all border border-gray-100">--</div>
                        <div id="drawn-indicator" class="absolute -top-3 -right-3 bg-orange-500 text-white px-4 py-1.5 rounded-full text-xs font-black shadow-lg border-4 border-white hidden">0/0</div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm">
                            <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1">Min Value</label>
                            <input type="number" id="min-val" value="1" class="w-full text-center bg-transparent font-black text-2xl outline-none" onchange="resetDrawn()">
                        </div>
                        <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm">
                            <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1">Max Value</label>
                            <input type="number" id="max-val" value="40" class="w-full text-center bg-transparent font-black text-2xl outline-none" onchange="resetDrawn()">
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="spin()" class="flex-1 bg-orange-500 text-white py-5 rounded-3xl font-black shadow-xl shadow-orange-100 hover:bg-orange-600 active:scale-95 transition-all text-xl">
                            ‡∏™‡∏∏‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç!
                        </button>
                        <button onclick="resetDrawn()" class="p-5 bg-gray-100 rounded-3xl text-gray-400 hover:bg-gray-200 hover:text-indigo-600 transition-all border" title="Reset History">
                            <i data-lucide="rotate-ccw"></i>
                        </button>
                    </div>
                </div>
            </div>

        </main>

        <!-- Navigation Bar (Bottom) -->
        <nav class="p-3 md:p-5 bg-white border-t flex justify-around items-center shadow-2xl relative z-10">
            <button onclick="switchTab('play')" id="tab-play" class="tool-btn active group">
                <i data-lucide="gamepad-2"></i>
                <span class="text-[9px] font-black mt-1 uppercase tracking-tighter">Play</span>
            </button>
            <button onclick="switchTab('board')" id="tab-board" class="tool-btn group">
                <i data-lucide="edit-3"></i>
                <span class="text-[9px] font-black mt-1 uppercase tracking-tighter">Board</span>
            </button>
            <button onclick="switchTab('scores')" id="tab-scores" class="tool-btn group">
                <i data-lucide="trophy"></i>
                <span class="text-[9px] font-black mt-1 uppercase tracking-tighter">Scores</span>
            </button>
            <button onclick="switchTab('random')" id="tab-random" class="tool-btn group">
                <i data-lucide="hash"></i>
                <span class="text-[9px] font-black mt-1 uppercase tracking-tighter">Random</span>
            </button>
        </nav>

    </div>

    <script>
        // --- Comprehensive Idiom Data (‡∏Å-‡∏Æ) ---
        const idiomsData = [
            { name: "‡∏Å‡∏á‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô", hint: "‡πÄ‡∏ß‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡∏±‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡πâ‡∏≠‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏≠‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏õ", emoji: "üé°" },
            { name: "‡∏Å‡∏ö‡πÉ‡∏ô‡∏Å‡∏∞‡∏•‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏ï‡πà‡∏ä‡∏≠‡∏ö‡∏≠‡∏ß‡∏î‡∏ï‡∏±‡∏ß‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏°‡∏≤‡∏Å", emoji: "üêö" },
            { name: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏π‡∏°", hint: "‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏Å‡πÉ‡∏à‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏ô‡∏ß‡∏∏‡πà‡∏ô‡∏ß‡∏≤‡∏¢", emoji: "üê∞" },
            { name: "‡∏Å‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏¢", hint: "‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏à‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô", emoji: "üê∏" },
            { name: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏á‡∏π‡πÑ‡∏°‡πà‡∏û‡πâ‡∏ô‡∏Ñ‡∏≠", hint: "‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡πâ‡∏≤‡∏¢‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏ô‡πÄ‡∏≠‡∏á", emoji: "üêç" },
            { name: "‡∏Ç‡∏¥‡∏á‡∏Å‡πá‡∏£‡∏≤ ‡∏Ç‡πà‡∏≤‡∏Å‡πá‡πÅ‡∏£‡∏á", hint: "‡∏Ñ‡∏ô‡∏™‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏£‡πâ‡∏≠‡∏ô‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡∏•‡∏î‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ô", emoji: "üå∂Ô∏è" },
            { name: "‡∏Ç‡∏µ‡πà‡∏ä‡πâ‡∏≤‡∏á‡∏à‡∏±‡∏ö‡∏ï‡∏±‡πä‡∏Å‡πÅ‡∏ï‡∏ô", hint: "‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏•‡∏á‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢", emoji: "üêò" },
            { name: "‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ï‡∏≤‡∏´‡∏•‡∏¥‡πà‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏¥‡πà‡∏ß‡∏ï‡∏≤‡∏ï‡∏≤‡∏°", hint: "‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà", emoji: "üëÅÔ∏è" },
            { name: "‡∏î‡∏¥‡∏ô‡∏û‡∏≠‡∏Å‡∏´‡∏≤‡∏á‡∏´‡∏°‡∏π", hint: "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡πà‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏ô‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢", emoji: "üê∑" },
            { name: "‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏´‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏±‡∏î", hint: "‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏¢‡πà‡∏≠‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", emoji: "üêï" },
            { name: "‡∏ï‡∏ö‡∏°‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á", hint: "‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏¢‡πà‡∏≠‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢", emoji: "üëè" },
            { name: "‡∏ï‡∏±‡∏Å‡∏ô‡πâ‡∏≥‡πÉ‡∏™‡πà‡∏Å‡∏∞‡πÇ‡∏´‡∏•‡∏Å ‡∏ä‡∏∞‡πÇ‡∏á‡∏Å‡∏î‡∏π‡πÄ‡∏á‡∏≤", hint: "‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á", emoji: "ü•£" },
            { name: "‡∏ô‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏ï‡∏±‡∏Å", hint: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏µ‡∏ö‡∏Ñ‡∏ß‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå", emoji: "üåä" },
            { name: "‡∏ô‡πâ‡∏≥‡∏•‡∏î‡∏ï‡∏≠‡∏ú‡∏∏‡∏î", hint: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≥‡∏ô‡∏≤‡∏à ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏≠‡∏≠‡∏Å‡∏°‡∏≤", emoji: "ü™µ" },
            { name: "‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏ï‡∏≤‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡∏≤‡∏Å", hint: "‡∏û‡∏π‡∏î‡∏à‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏à‡∏ô‡∏ô‡∏≥‡∏†‡∏±‡∏¢‡∏°‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏ô‡πÄ‡∏≠‡∏á", emoji: "üëÑ" },
            { name: "‡∏ù‡∏ô‡∏ó‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ç‡πá‡∏°", hint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏µ‡∏¢‡∏£‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏¢‡∏ß‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", emoji: "üßµ" },
            { name: "‡∏û‡∏π‡∏î‡πÑ‡∏õ‡∏™‡∏≠‡∏á‡πÑ‡∏û‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ‡∏ô‡∏¥‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ï‡∏≥‡∏•‡∏∂‡∏á‡∏ó‡∏≠‡∏á", hint: "‡∏Å‡∏≤‡∏£‡∏ô‡∏¥‡πà‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏¢‡πà‡∏≠‡∏°‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏û‡∏π‡∏î‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå", emoji: "ü§´" },
            { name: "‡∏ß‡∏±‡∏ß‡∏´‡∏≤‡∏¢‡∏•‡πâ‡∏≠‡∏°‡∏Ñ‡∏≠‡∏Å", hint: "‡∏Ñ‡∏¥‡∏î‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå", emoji: "üêÑ" },
            { name: "‡∏™‡∏µ‡πà‡∏ï‡∏µ‡∏ô‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏≤‡∏î ‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏≤‡∏ä‡∏ç‡πå‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏±‡πâ‡∏á", hint: "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏¢‡πà‡∏≠‡∏°‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ", emoji: "üêé" },
            { name: "‡∏´‡∏ô‡∏µ‡πÄ‡∏™‡∏∑‡∏≠‡∏õ‡∏∞‡∏à‡∏£‡∏∞‡πÄ‡∏Ç‡πâ", hint: "‡∏´‡∏ô‡∏µ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏à‡∏≠‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏Å‡∏ß‡πà‡∏≤", emoji: "üêä" },
            { name: "‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≠‡∏Å‡∏ö‡∏±‡∏ß", hint: "‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡πà‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏µ‡∏á‡∏≤‡∏°", emoji: "üå∏" },
            { name: "‡πÄ‡∏≠‡∏≤‡∏°‡∏∑‡∏≠‡∏ã‡∏∏‡∏Å‡∏´‡∏µ‡∏ö", hint: "‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô", emoji: "üì¶" }
        ];

        // --- State Management ---
        let currentIdx = 0;
        let gameScore = 0;
        let timeLeft = 20;
        let timerId = null;
        let quizPool = [];
        let drawnHistory = [];
        let groups = JSON.parse(localStorage.getItem('eduDashboardGroups')) || [
            {name: "‡∏ó‡∏µ‡∏°‡∏°‡∏±‡∏á‡∏Å‡∏£", score: 0, color: "bg-rose-500"}, 
            {name: "‡∏ó‡∏µ‡∏°‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ", score: 0, color: "bg-blue-500"},
            {name: "‡∏ó‡∏µ‡∏°‡∏™‡∏¥‡∏á‡πÇ‡∏ï", score: 0, color: "bg-emerald-500"}
        ];

        // --- Tab Switcher ---
        function switchTab(tabId) {
            document.querySelectorAll('.stage-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tool-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`stage-${tabId}`).classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');

            if(tabId === 'board') setTimeout(resizeCanvas, 50);
            if(tabId === 'scores') renderGroups();
            if(tabId === 'random') updateDrawnIndicator();
            
            lucide.createIcons();
        }

        // --- Header Score Display (Leaders on Top) ---
        function renderHeaderScores() {
            const container = document.getElementById('header-group-scores');
            container.innerHTML = '';
            
            const sorted = [...groups].sort((a, b) => b.score - a.score);
            
            sorted.forEach((g, idx) => {
                const badge = document.createElement('div');
                badge.className = `flex items-center gap-2 px-3 py-1.5 rounded-xl text-white text-[11px] font-black shadow-sm shrink-0 border border-white/20 ${g.color || 'bg-indigo-500'}`;
                badge.innerHTML = `
                    <span class="opacity-70">#${idx+1}</span>
                    <span>${g.name}</span>
                    <span class="bg-black/20 px-1.5 rounded-lg">${g.score}</span>
                `;
                container.appendChild(badge);
            });
        }

        // --- Quiz Game Logic ---
        function startGame() {
            gameScore = 0; currentIdx = 0;
            quizPool = [...idiomsData].sort(() => Math.random() - 0.5).slice(0, 10);
            document.getElementById('start-area').classList.add('hidden');
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('quiz-area').classList.remove('hidden');
            document.getElementById('current-score-display').innerText = "Pts: 0";
            loadQuiz();
        }

        function loadQuiz() {
            if(currentIdx >= quizPool.length) { endQuiz(); return; }
            const q = quizPool[currentIdx];
            
            document.getElementById('q-num-text').innerText = `Question ${currentIdx + 1}/${quizPool.length}`;
            document.getElementById('q-hint').innerText = q.hint;
            document.getElementById('q-emoji').innerText = q.emoji;
            document.getElementById('game-progress-bar').style.width = `${(currentIdx / quizPool.length) * 100}%`;

            let opts = [q.name];
            let pool = idiomsData.filter(i => i.name !== q.name);
            opts.push(...pool.sort(() => Math.random() - 0.5).slice(0, 3).map(i => i.name));
            opts.sort(() => Math.random() - 0.5);

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            
            const btnStyles = [
                'bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100',
                'bg-emerald-50 border-emerald-200 text-emerald-700 hover:bg-emerald-100',
                'bg-amber-50 border-amber-200 text-amber-700 hover:bg-amber-100',
                'bg-rose-50 border-rose-200 text-rose-700 hover:bg-rose-100'
            ];

            opts.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = `p-5 border-2 rounded-[24px] font-bold transition-all shadow-sm active:scale-95 text-sm md:text-lg ${btnStyles[i]}`;
                b.innerText = opt;
                b.onclick = () => checkAnswer(opt, q.name);
                grid.appendChild(b);
            });
            startTimer();
        }

        function startTimer() {
            clearInterval(timerId); timeLeft = 20;
            const el = document.getElementById('timer-text');
            el.innerText = "20";
            timerId = setInterval(() => {
                timeLeft -= 0.1;
                el.innerText = Math.ceil(timeLeft);
                if(timeLeft <= 0) checkAnswer(null, quizPool[currentIdx].name);
            }, 100);
        }

        function checkAnswer(sel, cor) {
            clearInterval(timerId);
            const btns = document.querySelectorAll('#options-grid button');
            btns.forEach(b => {
                b.disabled = true;
                if(b.innerText === cor) b.className = "p-5 bg-green-500 border-green-600 text-white rounded-[24px] font-bold shadow-lg scale-105 z-10";
                else if(b.innerText === sel) b.className = "p-5 bg-red-500 border-red-600 text-white rounded-[24px] font-bold opacity-60";
                else b.className = "p-5 bg-gray-100 border-gray-200 text-gray-400 rounded-[24px] font-bold opacity-40";
            });

            if(sel === cor) {
                const pts = Math.ceil(timeLeft) * 10;
                gameScore += pts;
                document.getElementById('current-score-display').innerText = `Pts: ${gameScore}`;
            }

            setTimeout(() => { currentIdx++; loadQuiz(); }, 2000);
        }

        function endQuiz() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('final-game-score').innerText = gameScore;
            document.getElementById('game-progress-bar').style.width = "100%";
        }

        function resetGame() {
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('start-area').classList.remove('hidden');
            document.getElementById('game-progress-bar').style.width = "0%";
        }

        // --- Whiteboard Logic ---
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        let painting = false; let eraserMode = false;

        function resizeCanvas() {
            const box = canvas.parentElement;
            const temp = ctx.getImageData(0, 0, canvas.width, canvas.height);
            canvas.width = box.clientWidth;
            canvas.height = box.clientHeight;
            ctx.lineCap = 'round'; ctx.lineJoin = 'round';
            ctx.putImageData(temp, 0, 0);
        }

        function startDrawing(e) { painting = true; draw(e); }
        function endDrawing() { painting = false; ctx.beginPath(); }
        function draw(e) {
            if(!painting) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
            const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
            ctx.lineWidth = document.getElementById('pen-size').value;
            ctx.strokeStyle = eraserMode ? '#FFFFFF' : document.getElementById('pen-color').value;
            ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
        }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        function setEraser() {
            eraserMode = !eraserMode;
            document.getElementById('eraser-btn').classList.toggle('bg-indigo-600', eraserMode);
            document.getElementById('eraser-btn').classList.toggle('text-white', eraserMode);
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mouseup', endDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
        canvas.addEventListener('touchend', endDrawing);
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });

        // --- Score Management ---
        function addGroup() {
            const inp = document.getElementById('new-group-input');
            if(!inp.value.trim()) return;
            const colors = ['bg-rose-500', 'bg-blue-500', 'bg-emerald-500', 'bg-amber-500', 'bg-violet-500', 'bg-cyan-500'];
            const color = colors[groups.length % colors.length];
            groups.push({name: inp.value.trim(), score: 0, color});
            inp.value = ''; renderGroups(); renderHeaderScores();
        }

        function renderGroups() {
            const list = document.getElementById('groups-list');
            list.innerHTML = '';
            groups.forEach((g, i) => {
                const row = document.createElement('div');
                row.className = "flex items-center justify-between p-4 bg-gray-50 rounded-3xl border border-gray-100 shadow-sm";
                row.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-4 h-4 rounded-full ${g.color}"></div>
                        <span class="font-extrabold text-gray-700">${g.name}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="updateGroupScore(${i}, -10)" class="w-10 h-10 flex items-center justify-center bg-white rounded-xl text-red-500 font-black shadow-sm border border-red-50 hover:bg-red-50">-</button>
                        <span class="text-2xl font-black text-indigo-900 w-12 text-center">${g.score}</span>
                        <button onclick="updateGroupScore(${i}, 10)" class="w-10 h-10 flex items-center justify-center bg-white rounded-xl text-green-500 font-black shadow-sm border border-green-50 hover:bg-green-50">+</button>
                        <button onclick="delGroup(${i})" class="ml-2 text-gray-300 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                `;
                list.appendChild(row);
            });
            lucide.createIcons();
            localStorage.setItem('eduDashboardGroups', JSON.stringify(groups));
        }

        function updateGroupScore(i, val) {
            groups[i].score = Math.max(0, groups[i].score + val);
            renderGroups(); renderHeaderScores();
        }

        function delGroup(i) {
            if(confirm(`‡∏•‡∏ö ${groups[i].name}?`)) {
                groups.splice(i, 1); renderGroups(); renderHeaderScores();
            }
        }

        // --- Randomizer Logic ---
        function resetDrawn() {
            drawnHistory = [];
            document.getElementById('rand-display').innerText = "--";
            document.getElementById('random-status-text').innerText = "History Reset";
            updateDrawnIndicator();
        }

        function updateDrawnIndicator() {
            const min = parseInt(document.getElementById('min-val').value);
            const max = parseInt(document.getElementById('max-val').value);
            const range = max - min + 1;
            const el = document.getElementById('drawn-indicator');
            const noRep = document.getElementById('no-repeat').checked;
            if(noRep && range > 0) {
                el.classList.remove('hidden');
                el.innerText = `${drawnHistory.length}/${range}`;
            } else el.classList.add('hidden');
        }

        function spin() {
            const min = parseInt(document.getElementById('min-val').value);
            const max = parseInt(document.getElementById('max-val').value);
            const display = document.getElementById('rand-display');
            const noRep = document.getElementById('no-repeat').checked;
            const range = max - min + 1;

            if(isNaN(min) || isNaN(max) || min >= max) { display.innerText = "!!"; return; }
            if(noRep && drawnHistory.length >= range) { display.innerText = "‡∏Ñ‡∏£‡∏ö"; return; }

            document.getElementById('random-status-text').innerText = "Spinning...";
            
            let count = 0;
            const interval = setInterval(() => {
                display.innerText = Math.floor(Math.random() * (max - min + 1)) + min;
                if(++count > 15) {
                    clearInterval(interval);
                    let val;
                    if(noRep) {
                        do { val = Math.floor(Math.random() * (max - min + 1)) + min; } 
                        while(drawnHistory.includes(val));
                        drawnHistory.push(val);
                    } else val = Math.floor(Math.random() * (max - min + 1)) + min;
                    
                    display.innerText = val;
                    document.getElementById('random-status-text').innerText = "Lucky Winner!";
                    updateDrawnIndicator();
                }
            }, 60);
        }

        // Init
        window.onload = () => {
            lucide.createIcons();
            renderHeaderScores();
            resizeCanvas();
        };
        window.onresize = resizeCanvas;
    </script>
</body>
</html>
