<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏õ‡∏£‡∏∞‡∏•‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤ ‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢ Ultimate v5.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            margin: 0; padding: 10px;
        }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
            width: 95vw;
            height: 95vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ‡∏•‡πá‡∏≠‡∏Ñ‡∏Ç‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å‡πÑ‡∏ß‡πâ */
        }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        main {
            flex: 1;
            overflow-y: auto; /* ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏™‡πÇ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏£‡πå‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
            scrollbar-width: thin;
            scrollbar-color: #6366f1 transparent;
        }

        /* Styling ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Chrome, Safari ‡πÅ‡∏•‡∏∞ Edge */
        main::-webkit-scrollbar {
            width: 8px;
        }
        main::-webkit-scrollbar-track {
            background: transparent;
        }
        main::-webkit-scrollbar-thumb {
            background-color: #6366f1;
            border-radius: 20px;
        }

        .stage-content {
            display: none; width: 100%; min-height: 100%;
            animation: fadeIn 0.4s ease-out;
        }
        .stage-content.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .choice-btn {
            @apply p-4 md:p-6 border-b-8 rounded-[2rem] font-black transition-all active:scale-95 active:border-b-0 shadow-xl text-xl md:text-2xl text-center bg-white;
        }
        .choice-0 { @apply border-purple-500 text-purple-700 hover:bg-purple-50; }
        .choice-1 { @apply border-blue-500 text-blue-700 hover:bg-blue-50; }
        .choice-2 { @apply border-pink-500 text-pink-700 hover:bg-pink-50; }
        .choice-3 { @apply border-orange-500 text-orange-700 hover:bg-orange-50; }

        .podium-base {
            @apply w-full rounded-t-[3rem] flex flex-col items-center justify-center text-white font-black shadow-2xl relative;
            transition: height 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .rank-1 { @apply bg-gradient-to-t from-yellow-600 to-yellow-300 text-yellow-900 border-t-8 border-yellow-200; }
        .rank-2 { @apply bg-gradient-to-t from-slate-500 to-slate-200 text-slate-800 border-t-8 border-slate-100; }
        .rank-3 { @apply bg-gradient-to-t from-orange-700 to-orange-400 text-orange-100 border-t-8 border-orange-200; }

        .crown-animate {
            animation: crownFloat 2s infinite ease-in-out;
        }
        @keyframes crownFloat { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-30px) rotate(5deg); } }
    </style>
</head>
<body>

    <div class="glass border border-white/50">
        
        <header class="p-4 md:p-6 border-b flex justify-between items-center bg-white/60 backdrop-blur-md z-10 shrink-0">
            <div class="flex items-center gap-3 md:gap-5">
                <div class="bg-indigo-600 p-2 md:p-4 rounded-2xl text-white shadow-lg">
                    <i data-lucide="book-open" class="w-6 h-6 md:w-8 md:h-8"></i>
                </div>
                <div>
                    <h1 class="text-lg md:text-2xl font-black text-indigo-900 leading-none">‡πÄ‡∏Å‡πà‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢</h1>
                    <p class="text-[10px] md:text-xs text-indigo-400 font-bold uppercase tracking-[0.2em] md:tracking-[0.3em] mt-1 md:mt-2">Quiz Master Edition 95% Wide</p>
                </div>
            </div>
            <div id="header-scores" class="flex gap-2 md:gap-3 overflow-x-auto no-scrollbar items-center max-w-[40%]"></div>
        </header>

        <main id="main-scroll">
            
            <div id="stage-start" class="stage-content active flex-col items-center justify-center p-8 text-center">
                <div class="bg-white p-8 md:p-12 rounded-[40px] md:rounded-[50px] shadow-2xl mb-8 md:mb-12 border-4 border-indigo-100 w-full max-w-4xl">
                    <h2 class="text-4xl md:text-6xl font-black text-indigo-900 mb-4">‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</h2>
                    <p class="text-gray-400 font-bold italic text-xl md:text-2xl">‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢‡∏î‡∏µ‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô?</p>
                </div>
                <div class="flex flex-col md:flex-row gap-4 md:gap-8 w-full max-w-2xl">
                    <button onclick="initGame('single')" class="flex-1 bg-white text-indigo-600 border-4 border-indigo-100 px-8 py-6 rounded-[2rem] font-black text-2xl shadow-2xl hover:border-indigo-500 transition-all flex items-center justify-center gap-4">
                        <i data-lucide="user" class="w-8 h-8"></i> ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                    </button>
                    <button onclick="initGame('team')" class="flex-1 bg-indigo-600 text-white px-8 py-6 rounded-[2rem] font-black text-2xl shadow-2xl hover:bg-indigo-700 transition-all flex items-center justify-center gap-4">
                        <i data-lucide="users" class="w-8 h-8"></i> ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
                    </button>
                </div>
            </div>

            <div id="stage-team-select" class="stage-content flex-col items-center justify-center p-8">
                <h2 class="text-3xl md:text-5xl font-black text-indigo-900 mb-8 text-center">‡∏ó‡∏µ‡∏°‡πÉ‡∏î‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ?</h2>
                <div id="team-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 w-full max-w-6xl"></div>
            </div>

            <div id="stage-quiz" class="stage-content flex-col items-center p-6 md:p-8">
                <div class="w-full max-w-7xl flex justify-between items-end mb-4">
                    <div class="bg-indigo-600 text-white px-6 py-2 rounded-full font-black text-sm md:text-xl" id="q-counter">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1/10</div>
                    <div class="flex items-center gap-2 md:gap-4 text-rose-500 font-black text-3xl md:text-5xl">
                        <i data-lucide="clock" class="w-8 h-8 md:w-12 md:h-12"></i>
                        <span id="timer-val" class="tabular-nums">60</span>
                    </div>
                </div>

                <div class="w-full max-w-7xl bg-gray-200 h-3 md:h-5 rounded-full mb-6 md:mb-10 overflow-hidden shadow-inner border-2 border-white shrink-0">
                    <div id="timer-bar" class="h-full bg-rose-500 transition-all duration-100" style="width: 100%"></div>
                </div>

                <div class="w-full max-w-7xl bg-white rounded-[40px] md:rounded-[60px] p-8 md:p-16 shadow-2xl border-t-[8px] md:border-t-[12px] border-indigo-600 text-center relative mb-8 md:mb-12 min-h-[250px] md:min-h-[350px] flex flex-col justify-center shrink-0">
                    <p class="text-indigo-300 font-black uppercase tracking-[0.2em] md:tracking-[0.4em] text-[10px] md:text-sm mb-4 md:mb-6">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠...</p>
                    <h3 id="q-text" class="text-2xl md:text-5xl font-black text-gray-800 leading-tight px-4 md:px-10"></h3>
                    <div id="current-player" class="absolute -bottom-6 left-1/2 -translate-x-1/2 px-6 md:px-10 py-2 md:py-3 rounded-full text-sm md:text-xl font-bold shadow-2xl border-4 border-white whitespace-nowrap"></div>
                </div>

                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 w-full max-w-7xl pb-10"></div>
            </div>

            <div id="stage-result" class="stage-content flex-col items-center justify-center p-8">
                <h2 class="text-4xl md:text-7xl font-black text-indigo-900 mb-10 md:mb-20 italic tracking-tighter drop-shadow-lg text-center">üèÜ HALL OF FAME üèÜ</h2>
                <div id="podium-wrap" class="flex items-end justify-center gap-4 md:gap-12 w-full max-w-6xl h-64 md:h-96 mb-12 md:mb-20 px-4"></div>
                <button onclick="location.reload()" class="bg-indigo-600 text-white px-12 md:px-20 py-4 md:py-6 rounded-[1.5rem] md:rounded-[2rem] font-black text-xl md:text-3xl hover:bg-indigo-700 transition-all shadow-2xl flex items-center gap-4">
                    <i data-lucide="home" class="w-8 h-8"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
            </div>

        </main>
        
        <nav id="bottom-nav" class="p-4 md:p-6 bg-white/80 border-t flex justify-around shrink-0">
            <button onclick="switchTab('start')" class="flex flex-col items-center text-indigo-600 font-bold text-xs gap-1"><i data-lucide="play-circle"></i>PLAY</button>
            <button onclick="openManageTeams()" class="flex flex-col items-center text-gray-400 font-bold text-xs gap-1"><i data-lucide="users"></i>TEAMS</button>
        </nav>
    </div>

    <div id="team-modal" class="fixed inset-0 bg-black/70 hidden z-50 flex items-center justify-center p-6">
        <div class="bg-white rounded-[3rem] w-full max-w-2xl p-6 md:p-10 shadow-2xl">
            <h3 class="text-3xl md:text-4xl font-black mb-6 md:mb-8 text-indigo-900">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</h3>
            <div id="modal-teams-list" class="space-y-3 mb-8 md:mb-10 max-h-[30vh] md:max-h-[40vh] overflow-y-auto pr-4"></div>
            <div class="flex gap-4">
                <input type="text" id="add-team-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà..." class="flex-1 border-4 rounded-2xl px-6 py-3 text-xl font-black outline-none border-indigo-50 focus:border-indigo-500">
                <button onclick="addNewTeam()" class="bg-indigo-600 text-white px-6 rounded-2xl hover:bg-indigo-700 transition-all shadow-lg"><i data-lucide="plus" class="w-8 h-8"></i></button>
            </div>
            <button onclick="closeModal()" class="w-full mt-8 md:mt-10 py-4 bg-gray-100 rounded-2xl text-xl font-black hover:bg-gray-200">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        // JS ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤
        const idiomsLibrary = [
            { name: "‡∏Å‡∏á‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡πÄ‡∏Å‡∏ß‡∏µ‡∏¢‡∏ô", hint: "‡πÄ‡∏ß‡∏£‡∏ò‡∏£‡∏£‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏ô‡∏≠‡∏á ‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏¢‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô" },
            { name: "‡∏Å‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏¢", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏≥‡∏ö‡∏≤‡∏Å" },
            { name: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏π‡∏°", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏∑‡πà‡∏ô‡∏ï‡∏Å‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á" },
            { name: "‡∏Ç‡∏ß‡πâ‡∏≤‡∏á‡∏á‡∏π‡πÑ‡∏°‡πà‡∏û‡πâ‡∏ô‡∏Ñ‡∏≠", hint: "‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏£‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏•‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î" },
            { name: "‡∏Ç‡∏¥‡∏á‡∏Å‡πá‡∏£‡∏≤ ‡∏Ç‡πà‡∏≤‡∏Å‡πá‡πÅ‡∏£‡∏á", hint: "‡∏ï‡πà‡∏≤‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏£‡πâ‡∏≠‡∏ô‡∏û‡∏≠‡πÜ ‡∏Å‡∏±‡∏ô" },
            { name: "‡∏Ç‡∏µ‡πà‡∏ä‡πâ‡∏≤‡∏á‡∏à‡∏±‡∏ö‡∏ï‡∏±‡πä‡∏Å‡πÅ‡∏ï‡∏ô", hint: "‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏•‡∏á‡πÅ‡∏£‡∏á‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢" },
            { name: "‡∏î‡∏¥‡∏ô‡∏û‡∏≠‡∏Å‡∏´‡∏≤‡∏á‡∏´‡∏°‡∏π", hint: "‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡πà‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏ô‡∏ó‡∏≥‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á" },
            { name: "‡∏ô‡πâ‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏ï‡∏±‡∏Å", hint: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏î‡∏µ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏µ‡∏ö‡∏Ñ‡∏ß‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà" },
            { name: "‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏≠‡∏ï‡∏≤‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡∏≤‡∏Å", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á" },
            { name: "‡∏ß‡∏±‡∏ß‡∏´‡∏≤‡∏¢‡∏•‡πâ‡∏≠‡∏°‡∏Ñ‡∏≠‡∏Å", hint: "‡∏Ñ‡∏¥‡∏î‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß" },
            { name: "‡∏ô‡∏Å‡∏™‡∏≠‡∏á‡∏´‡∏±‡∏ß", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏ß‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå" },
            { name: "‡∏à‡∏±‡∏ö‡∏õ‡∏•‡∏≤‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠", hint: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏∏‡πà‡∏á‡∏´‡∏ß‡∏±‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏™‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á" },
            { name: "‡∏ä‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏≤‡πÉ‡∏ö‡∏ö‡∏±‡∏ß‡∏õ‡∏¥‡∏î", hint: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏õ‡∏Å‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏°‡πà‡∏°‡∏¥‡∏î" },
            { name: "‡∏õ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏Ç‡∏¢‡∏¥‡∏ö", hint: "‡∏û‡∏π‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏≠‡∏µ‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏ß‡πâ" },
            { name: "‡∏™‡∏µ‡πà‡∏ï‡∏µ‡∏ô‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏≤‡∏î ‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏≤‡∏ä‡∏ç‡πå‡∏¢‡∏±‡∏á‡∏£‡∏π‡πâ‡∏û‡∏•‡∏±‡πâ‡∏á", hint: "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏¢‡πà‡∏≠‡∏°‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏à" }
        ];

        let groups = [
            { name: "‡∏ó‡∏µ‡∏°‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤", score: 0, color: "bg-blue-500" },
            { name: "‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏•‡∏¥‡∏á‡∏ô‡∏¥‡∏•", score: 0, color: "bg-rose-500" },
            { name: "‡∏ó‡∏µ‡∏°‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå‡∏Ç‡∏≤‡∏ß", score: 0, color: "bg-emerald-500" }
        ];

        let gameMode = 'single', activeGroupIdx = null, currentQ = 0, score = 0, timer = null, timeLeft = 60, quizPool = [];

        function switchTab(id) {
            document.querySelectorAll('.stage-content').forEach(s => s.classList.remove('active'));
            document.getElementById('stage-' + id).classList.add('active');
            document.getElementById('main-scroll').scrollTop = 0; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            lucide.createIcons();
        }

        function initGame(mode) {
            gameMode = mode;
            currentQ = 0; score = 0;
            quizPool = [...idiomsLibrary].sort(() => Math.random() - 0.5).slice(0, 10);
            document.getElementById('bottom-nav').classList.add('hidden');
            if(mode === 'team') showTeamSelect(); else startQuiz();
        }

        function showTeamSelect() {
            const grid = document.getElementById('team-grid');
            grid.innerHTML = '';
            groups.forEach((g, i) => {
                const btn = document.createElement('button');
                btn.className = `${g.color} text-white p-8 md:p-12 rounded-[2.5rem] md:rounded-[3.5rem] font-black shadow-2xl hover:scale-105 transition-all text-xl md:text-3xl border-8 border-white/20`;
                btn.innerHTML = `${g.name}<br><span class="text-base md:text-xl opacity-80">${g.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>`;
                btn.onclick = () => { activeGroupIdx = i; startQuiz(); };
                grid.appendChild(btn);
            });
            switchTab('team-select');
        }

        function startQuiz() {
            if(currentQ >= 10) { endShow(); return; }
            const q = quizPool[currentQ];
            document.getElementById('q-counter').innerText = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${currentQ + 1}/10`;
            document.getElementById('q-text').innerText = q.hint;
            
            const playerInd = document.getElementById('current-player');
            if(gameMode === 'team') {
                playerInd.innerText = `‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö: ${groups[activeGroupIdx].name}`;
                playerInd.className = `absolute -bottom-6 left-1/2 -translate-x-1/2 px-10 py-3 rounded-full text-xl font-bold shadow-2xl border-4 border-white ${groups[activeGroupIdx].color} text-white`;
            } else {
                playerInd.innerText = '‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß';
                playerInd.className = `absolute -bottom-6 left-1/2 -translate-x-1/2 px-10 py-3 rounded-full text-xl font-bold shadow-2xl border-4 border-white bg-indigo-600 text-white`;
            }

            let options = [q.name];
            let others = idiomsLibrary.filter(i => i.name !== q.name).sort(() => Math.random() - 0.5);
            options.push(...others.slice(0, 3).map(i => i.name));
            options.sort(() => Math.random() - 0.5);

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = `choice-btn choice-${i}`;
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.name);
                container.appendChild(btn);
            });

            switchTab('quiz');
            startTimer();
        }

        function startTimer() {
            clearInterval(timer);
            timeLeft = 60;
            const bar = document.getElementById('timer-bar');
            const txt = document.getElementById('timer-val');
            timer = setInterval(() => {
                timeLeft -= 0.1;
                if (timeLeft < 0) timeLeft = 0;
                txt.innerText = Math.ceil(timeLeft);
                bar.style.width = (timeLeft/60*100) + "%";
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    checkAnswer(null, quizPool[currentQ].name);
                }
            }, 100);
        }

        function checkAnswer(sel, cor) {
            clearInterval(timer);
            const btns = document.querySelectorAll('.choice-btn');
            btns.forEach(b => {
                b.disabled = true;
                if(b.innerText === cor) {
                    b.classList.remove('bg-white');
                    b.classList.add('bg-emerald-500', 'text-white', 'border-emerald-700', 'scale-105', 'z-20');
                } else if(b.innerText === sel) {
                    b.classList.remove('bg-white');
                    b.classList.add('bg-rose-500', 'text-white', 'border-rose-700', 'opacity-50');
                }
            });

            if(sel === cor) {
                const pts = Math.ceil(timeLeft);
                if(gameMode === 'team') groups[activeGroupIdx].score += pts; else score += pts;
                confetti({ particleCount: 80, spread: 80, origin: { y: 0.75 } });
            }

            currentQ++;
            setTimeout(() => {
                if(gameMode === 'team' && currentQ < 10) showTeamSelect();
                else startQuiz();
                updateScoreHeader();
            }, 1800);
        }

        function endShow() {
            switchTab('result');
            const wrap = document.getElementById('podium-wrap');
            wrap.innerHTML = '';

            let sorted = [...groups].sort((a,b) => b.score - a.score);
            let currentRank = 1;
            sorted.forEach((team, i) => {
                if(i > 0 && team.score < sorted[i-1].score) currentRank = i + 1;
                team.rank = currentRank;
            });

            const p1 = sorted.filter(t => t.rank === 1);
            const p2 = sorted.filter(t => t.rank === 2);
            const p3 = sorted.filter(t => t.rank === 3);
            
            [...p2, ...p1, ...p3].forEach(team => {
                const col = document.createElement('div');
                col.className = "podium-item flex flex-col items-center justify-end flex-1 max-w-[200px]";
                let h = team.rank === 1 ? "80%" : (team.rank === 2 ? "60%" : "40%");
                col.innerHTML = `
                    <div class="mb-2 md:mb-6 text-center w-full relative">
                        ${team.rank === 1 ? '<div class="crown-animate text-3xl md:text-6xl mb-2">üëë</div>' : ''}
                        <div class="font-black text-indigo-900 text-xs md:text-xl truncate px-1">${team.name}</div>
                        <div class="text-indigo-600 font-black bg-white rounded-xl px-2 md:px-5 py-1 md:py-2 inline-block mt-1 shadow-lg text-[10px] md:text-base">${team.score}</div>
                    </div>
                    <div class="podium-base rank-${team.rank}" style="height: ${h}">
                        <span class="text-3xl md:text-6xl italic">${team.rank}</span>
                    </div>`;
                wrap.appendChild(col);
            });

            confetti({ particleCount: 500, spread: 120, origin: { y: 0.5 } });
        }

        function updateScoreHeader() {
            const h = document.getElementById('header-scores');
            h.innerHTML = '';
            [...groups].sort((a,b) => b.score - a.score).forEach(g => {
                const badge = document.createElement('div');
                badge.className = `${g.color} text-white px-3 md:px-5 py-1.5 md:py-2.5 rounded-xl md:rounded-2xl text-[10px] md:text-xs font-black flex items-center gap-2 md:gap-3 shadow-xl border border-white/20 whitespace-nowrap`;
                badge.innerHTML = `<span>${g.name}</span><span class="bg-black/20 px-2 rounded-lg md:rounded-xl">${g.score}</span>`;
                h.appendChild(badge);
            });
        }

        function openManageTeams() {
            document.getElementById('team-modal').classList.remove('hidden');
            renderModalTeams();
        }
        function closeModal() { document.getElementById('team-modal').classList.add('hidden'); }
        function renderModalTeams() {
            const list = document.getElementById('modal-teams-list');
            list.innerHTML = '';
            groups.forEach((g, i) => {
                list.innerHTML += `<div class="flex justify-between items-center p-4 bg-indigo-50 rounded-2xl border-2 border-indigo-100 shadow-sm">
                    <span class="font-black text-xl text-indigo-900">${g.name}</span>
                    <button onclick="removeTeam(${i})" class="text-rose-500 hover:scale-125 transition-all"><i data-lucide="trash-2" class="w-6 h-6 md:w-8 md:h-8"></i></button>
                </div>`;
            });
            lucide.createIcons();
        }
        function addNewTeam() {
            const inp = document.getElementById('add-team-input');
            if(!inp.value.trim()) return;
            const colors = ['bg-blue-500', 'bg-rose-500', 'bg-emerald-500', 'bg-amber-500', 'bg-indigo-500', 'bg-fuchsia-500'];
            groups.push({ name: inp.value.trim(), score: 0, color: colors[groups.length % colors.length] });
            inp.value = ''; renderModalTeams(); updateScoreHeader();
        }
        function removeTeam(i) { if(groups.length > 1) { groups.splice(i, 1); renderModalTeams(); updateScoreHeader(); } }

        window.onload = () => { lucide.createIcons(); updateScoreHeader(); };
    </script>
</body>
</html>
